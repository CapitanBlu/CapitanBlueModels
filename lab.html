<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Capitan-Lab Ultimate | Professional Suite</title>
    <script async src="https://unpkg.com/es-module-shims@1.8.0/dist/es-module-shims.js"></script>
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.157.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.157.0/examples/jsm/"
        }
    }
    </script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --b-dark: #1d1d1d; --b-panel: #303030; --b-header: #424242; --b-accent: #e58d2a; --border: #111; }
        body, html { margin: 0; padding: 0; height: 100%; background: #111; color: #bdbdbd; font-family: 'Inter', sans-serif; font-size: 11px; overflow: hidden; }
        
        .blender-layout { display: grid; grid-template-columns: 240px 1fr 280px; grid-template-rows: 28px 1fr 24px; height: 100vh; }
        header, footer { grid-column: 1 / 4; background: var(--b-header); border: 1px solid var(--border); display: flex; align-items: center; padding: 0 10px; z-index: 100; }
        
        /* TABS SUPERIORES (Layouts) */
        .layout-tabs { display: flex; gap: 2px; margin-left: 20px; }
        .tab { padding: 4px 12px; background: #333; cursor: pointer; border-radius: 4px 4px 0 0; border: 1px solid var(--border); border-bottom: none; }
        .tab.active { background: var(--b-panel); color: var(--b-accent); font-weight: bold; }

        .sidebar { background: var(--b-panel); border: 1px solid var(--border); overflow-y: auto; padding: 10px; }
        .p-head { background: #4d4d4d; padding: 6px; color: #fff; font-weight: bold; margin: -10px -10px 10px -10px; border-bottom: 1px solid #111; font-size: 10px; text-transform: uppercase; }
        
        .b-btn { background: #555; border: 1px solid #333; color: #eee; padding: 6px; cursor: pointer; width: 100%; margin-bottom: 4px; text-align: left; font-size: 10px; border-radius: 2px; }
        .b-btn:hover { background: #666; }
        .b-btn.active { background: var(--b-accent); color: #000; }

        #viewport { background: #393939; position: relative; }
        .brush-cursor { position: absolute; border: 1px solid white; border-radius: 50%; pointer-events: none; display: none; transform: translate(-50%, -50%); }
    </style>
</head>
<body>

<div class="blender-layout">
    <header>
        <span style="font-weight:900; color:var(--b-accent);">CAPITAN-LAB</span>
        <div class="layout-tabs">
            <div class="tab active" onclick="setContext('layout')">Layout</div>
            <div class="tab" onclick="setContext('sculpt')">Sculpting</div>
            <div class="tab" onclick="setContext('paint')">Texture Paint</div>
            <div class="tab" onclick="setContext('rig')">Rigging</div>
        </div>
    </header>

    <div class="sidebar" id="tool-panel">
        <div id="tools-layout">
            <div class="p-head">Add Geometry</div>
            <button class="b-btn" onclick="addObj('cube')">Cube</button>
            <button class="b-btn" onclick="addObj('sphere')">Sphere</button>
        </div>

        <div id="tools-sculpt" style="display:none;">
            <div class="p-head">Brushes</div>
            <button class="b-btn active">Draw</button>
            <button class="b-btn">Inflate</button>
            <button class="b-btn">Smooth</button>
            <div class="p-head" style="margin-top:10px;">Settings</div>
            <label>Radius</label><input type="range" style="width:100%">
        </div>

        <div id="tools-paint" style="display:none;">
            <div class="p-head">Colors</div>
            <input type="color" id="paint-color" style="width:100%; height:40px;">
            <button class="b-btn" style="margin-top:10px;">Flood Fill</button>
        </div>

        <div id="tools-rig" style="display:none;">
            <div class="p-head">Skeleton</div>
            <button class="b-btn" onclick="addBone()">Add Bone (Shift+A)</button>
            <button class="b-btn">Generate Rig</button>
        </div>
    </div>

    <div id="viewport">
        <div id="brush" class="brush-cursor"></div>
    </div>

    <div class="sidebar">
        <div class="p-head">Scene Collection</div>
        <div id="outliner" style="background:#222; height:150px; margin-bottom:10px; padding:5px;"></div>
        
        <div class="p-head">Exporter</div>
        <button class="b-btn" style="background:var(--b-accent); color:000;" onclick="exportOBJ()">Export .OBJ</button>
        <button class="b-btn" style="background:#444;" onclick="alert('FBX via GLTFExporter...')">Export .FBX (Beta)</button>
    </div>

    <footer>
        <span>Editor Mode: <span id="current-mode">LAYOUT</span> | Capitan Engine 2026</span>
    </footer>
</div>

<script type="module">
    import * as THREE from 'three';
    import { OrbitControls } from 'three/addons/controls/OrbitControls.js';
    import { TransformControls } from 'three/addons/controls/TransformControls.js';
    import { OBJExporter } from 'three/addons/exporters/OBJExporter.js';

    let scene, camera, renderer, orbit, transform;
    const container = document.getElementById('viewport');

    init();
    animate();

    function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x393939);
        camera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 0.1, 1000);
        camera.position.set(10, 10, 10);

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        container.appendChild(renderer.domElement);

        scene.add(new THREE.GridHelper(20, 20, 0x222222, 0x444444));
        scene.add(new THREE.AmbientLight(0xffffff, 0.5));
        
        orbit = new OrbitControls(camera, renderer.domElement);
        transform = new TransformControls(camera, renderer.domElement);
        scene.add(transform);

        // Cambiar contextos (Tabs)
        window.setContext = function(mode) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            // Ocultar todos los paneles
            ['layout', 'sculpt', 'paint', 'rig'].forEach(m => {
                document.getElementById('tools-' + m).style.display = 'none';
            });
            // Mostrar seleccionado
            document.getElementById('tools-' + mode).style.display = 'block';
            document.getElementById('current-mode').innerText = mode.toUpperCase();
        };

        window.addObj = function(type) {
            let geo = type === 'cube' ? new THREE.BoxGeometry(2,2,2) : new THREE.SphereGeometry(2, 32, 32);
            let mesh = new THREE.Mesh(geo, new THREE.MeshStandardMaterial({color: 0x888888}));
            scene.add(mesh);
            transform.attach(mesh);
        };

        window.exportOBJ = function() {
            const exporter = new OBJExporter();
            const data = exporter.parse(scene);
            const link = document.createElement('a');
            link.href = URL.createObjectURL(new Blob([data], {type: 'text/plain'}));
            link.download = 'model_capitan.obj';
            link.click();
        };
    }

    function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
    }
</script>
</body>
</html>
